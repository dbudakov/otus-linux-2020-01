![](https://github.com/dbudakov/23.DNS/blob/master/images/DNS/dns.png)  
Есть `Client` и `NameServer(DNS)`, кэши пустые, никаких записей нет. По умолчанию клиент обращается к ДНС всегда рекурсивно, а ДНС собирает инфу итеративно.   
Изначально `Client` при запросе `"mail.ru"` смотрит файл `/etc/hosts`, в случае осутствия информации обращается к файлу `/etc/resolv.conf`, видит поисковые сервера в стоках `"nameserver"` и обращается к ДНС серверу. Причем механика работы с файлом такая - если первый `nameserver` не ответил, то `Client` обратиться ко второму `server'у` через 5 секунд, но если первый `nameserver` доступен и вернул ответ что для запрашиваемого адреса нет записей, то именно эта инфа запишется в кэш. И доспупа не будет. Поэтому нужно отслеживать чистоту файла `/etc/hosts`, на предмет не корректных серверов.  
`Client` спрашивает у `NameServer'a` рекурсивным запросом,позволяя таким образом серверу выяснить, запись для запрашиваемого пути, в случае с нерекусивным запросом, при отсутствии информации сервер просто вернет инфу об отсутствии информации.  
`NameServer` проверяет записи и понимает что информации для запрашиваемого  ДНС имени нет и запускиется `итеративный запрос`, он первым делом обращается к корневым серверам(`RootServers`),  к тем которые `"."`, `RootServer'a` естественно ничего не знают о `mail.ru`, но отвечают что знают сервер, который ответственен за зону `"ru"`, спроси у него. `NameServer` обращается к серверу авторитативному за зону `"ru"` - `RuDnsServers`, тот в свою очередь знает о `NS'ах` `mail.ru` (`ns1.mail.ru` и `ns2.mail.ru`) и отдает информацию о них  `NameServer'у`, `NameServer` в свою очередь вновь обращается, но уже к `ns1.mail.ru`, который выдает список `ip'шников` для доменного имени `"mail.ru"`. Обработав такой запрос от клиента `NameServer` отдает ему соответстующие записи.  
