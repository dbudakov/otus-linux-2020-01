BGP(border gateway protocol)- протокол пограничного шлюза
протокол более ручной, требует более тонкой настройки

  объединяет AS(eBGP)
  может использоваться внутри AS(iBGP)
  работает на уровне L4(179/tcp), но выполняет роль L3/OSI
  состояние пиринга определяет по состоянию TCP-сессии
  для построения таблицы маршрутизации использует номера AS
    маршрутизаторы постоянно обмениваются информацией о достижимости конкретных сетей, между AS, то есть если посмотреть на таблицу BGP, то там обозначена сеть и цепочка из AS чтобы до данной сети дойти
  может быть требователен к ресурсам маршрутизатора
  текущий размер полной таблицы маршрутизации сети Интернет-более 800k маршрутов

  02:52
  для работы необходим запущенный демон bgpd
  аналогичная настройка нужна на соседском роутере
    router bgp 64513                      #номер нашей AS
      bgp router-id 10.0.1.1              #Router-ID
      network 10.0.1.0/24                 #net
      neighbor 172.31.1.2 remote-as 64512 #ip соседа и его AS

  sh ip bgp
  sh ip bgp ipv4 unicast #таблица самого BGP
    Network      Next Hop    Metric  LocPrf Weight Path
*>  10.0.0.0/24  172.31.1.2  0                   0 64512 i
  здесь *           FIB(инсталяция в локальную табл. маршрутизации)
        10.0.0.0/24 целевая сеть
        172.31.1.2  куда идти
        64512       какую(-ие) AS нужно пройти чтобы достичь сети назначения

AS и префикс с "реальными"  IP-адресами выдают:
  LIR - локальный интернет регистратор
  RIR - региональный интернет регистратор[[RIPE NCCC](https://www.ripe.net)]
  Можно поднять пиринг по BGP, договорившись с другим оператором, В БД RIPE можно будет добавить информацию о  том, что сеть закреплена за вашей организацией
  Без номера AS можно поднять пиринг внутри сети, по аналогии с серыми ip адресами, использую номера AS от 64512 до 65534
  fullview - полная карта сети BGP, содержащая те самые 800k AS, нужно брать от провайдера только дефолтный маршрут, также можно открыть свои AS провайдеру
  BGP работает поверх VPN тунелей, для его работы достаточно IP адресов
  Анонсируют сети с длиной префикса не больше чем /24.

ВАЖНО при настройке BGP
  Настройка фильтров.Обязательна, и для входящих и для исходящих. Даже если речь про передачу только лишь маршрута по-умолчанию

  в случае если сеть анонсируется через два интерфейса, то через маршрутизатом может ходить трафик провайдера
  настройка фильтрации:
  Разрешаем нужный нам трафик(используя префикс)
    (config)# ip prefix-list ASIN seq 10 permit 10.0.1.0/24
  Запрещаем весь остально трафик(используя префикс)
    (config)# ip prefix-list ASIN seq 1000 deny 0.0.0.0/0 le 32
  Добавляем на соседа наш префикс лист
    (config)# router bgp 64512
    (config-router)# neighbor 172.31.1.1 prefix-list ASIN in
      здесь ASIN - имя префикс листа
            in - вход

    (config)# ip prefix-list ASOUT seq 10 172.16.1.0/24
    (config)# ip prefix-list ASOUT seq 20 192.168.0.0/23
    (config)# ip prefix-list ASIN seq 1000 deny 0.0.0.0/0 le 32
    (config)# do clear bgp * # заливка всех префиксов по новой
    (config)# router bgp 64512
    (config-router)# neighbor 172.31.1.1 prefix-list ASOUT out
