OSPF([Open Shortest Path First](http://subnets.ru/wrapper.php?p=8)) - иерархический протокол, делит сеть на зоны, основан на технологии отслеживания состояния канала(link-state), использует для нахождения кратчайшего пути Алгоритм Дейкстры(Dijkstra's algorithm)
  Для работы использует [89 протокол](https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml)  и multicast, на filrewall необходимо открывать не только сети 224.0.0.5, 224.0.0.6, но и 89 протокол.

В своей работе использует 5 типов пакетов:
  HELLO                               # Обнаружение соседей
    ТАЙМЕРЫ:
      + HelloInterval - значение по-умолчанию 10 сек, параметр должен быть одинаковым для каналов соединения
      + RouterDeadInterval - время по истечении которого связь прервется, в случае отсутствия ответа соседа, должен быть кратным значению, HelloInterval, по-умолчанию - 40 сек, параметр должен быть одинаковым для каналов соединения
      Wait Timer - время, в течении которого роутер после начала работы слушает сеть, на возможность поступления пакетов к нему, значение равно значению итервала RouterDeadInterval
      RxmtInterval - время, через которое пакет будет переотправлен, в случае если ответ на запрос не получен, называется также Retransmit Interval. Значение интервала 5 сек
    СОСТОЯНИЯ:
      Down: Соседские отношения не установлены
      Init: Получен Hello-пакет
      Two-Way: Роутер увидел свой ID в полученном Hello-пакете (установленная смежность)
      Exstart: Определение ролей: Master и Slave
      Exchange: DBD отправлена
      Loading: Обмен LSR и LSU
      + Full: Отношения установлены
  Database Description (DBD)          # Синхронизация базы данных между роутерами
  Link-State Request (LSR)            # Запрос link-state записей
  Link-State Update (LSU)             # Посылка link-state записей
  Link-State Acknowledgement (LSAck)  # Подтверждение о получении

ТЕРМИНОЛОГИЯ
  LSDB (Link state database) - структура(база) данных для хранения данных о топологии OSPF
  SPF (Shortest Path First) - название алгоритма OSPF для анализа LSDB и определения лучшего маршрута(с наименьшей стоимостью) для каждого префикса(тот самый алгоритм Дейкстры)
  LSU (Link State Update) - пакет OSPF, в котором передается детальная информация о топологии, в частности LSA(на случай изменения топологии)
  LSA (Link State Advertisement) - класс структуры данных OSPF, которые содержат информацию о топологии. LSA хранится в LSDB и передаются по сети внутри LSU
  Area - группа маршрутизаторов и их интерфейсов
  ABR (Area Border Router) - пограничный маршрутизатор, у которого интерфейсы подключены как минимум к двум разным OSPF Area, включая Backbone Area(area 0), вынуждены содержать LSDB двух(нескольких) зон, ставится приоритет к производительности железа
  ASBR (Autonomous System Border Router) - маршрутизатор, который соединяет 2 или более автономные системы и используется в основном для анонсирования маршрутов из одной AS в другую/другие(под разными AS в большей степени имеется ввиду разница в  протоколах маршрутизации).
  AS (Автономная система) - группа маршрутизаторов, обменивающаяся маршрутизирующей информацией с помощью одного протокола
  BR (Backbone router) - маршрутизатор, у которого как минимум один интерфейс находится в Backbone Area(area 0)
  IR (Internal router) - маршрутизатор, который находится в одной зоны
  DR (Designated Router) - маршрутизатор в multicast-сетях(в одной подсети может находиться более 2-х маршрутизаторов), который выбирается среди других маршрутизаторов для генерации LSA, обмена топологиями и т.д. Выбирается не в пределах всей сети, а в пределах одного канала(не линка)
  BDR (Backup Designated Router)- маршрутизатор в multiaccess-сетях который "наблюдает", за DR'ом и занимает его место в случае, если DR становится недоступным

LSA(1,2,3,4,5,7):
  vtysh>sh ip ospf database # вывод LSDB(содержажую LSA) из консоли quagga(vtysh)
  Type 1 - Router LSA(в пределах одной зоны)
    вещается каждым маршрутизатором только  в пределах своей зоны
    содержит список напрямую подключенных к роутеру линков
    линк описывается двумя параметрами: IP-префикс на интерфейс и тип линка(broadcast(default), non-broadcast, point-to-multipoint, point-to-point)
      на практике чаще всего сталкиваешся с ethernet(broadcast)(в котором нужно будет выбирать DR или BDR) и poin-to-point.
  Type 2 - Network LSA(в пределах одного канала(не линка, а канала))
    создана для много-доступных(multi-access) сетей
    генерируется DR. Содержит  список всех подключенных к сети маршрутизаторов, идентификатор DR, а также адрес и маску сети
    не выходит за пределы зоны, в которой была сгенерирована
  Type 3 - Summary LSA
    генерируется на ABR, для передачи в соседнюю зону LSA рассматриваемой зоны
  Type 4 - Summary ASBR LSA
    тип записи(к примеру о внешней сети) передаваемой через ABR в соседнюю зону, через рассматриваемую, причем для рассматриваемой зоны, это будет запись LSA Type 1

Зоны:
  От типа зоны зависит ограничение маршрутной информации о внешних и соседних сетях внутри нее. Настраиваются на пограничных маршрутизаторах(ABR), в некоторых случаях еще и внутри зоны(IR/DR).
  Типы зон(area):
    Area 0 Blackbone
    Area 1 Stub(не будет маршрутной информации о внешних сетях, но доступна о информация соседней)
      No type 5 external LSA
      No ASBR allowed
    Area 2 Totally Stub( не будет доступна информация о соседней сети, будет просто дефолт gateway на неё)
      No type 3 summary LSA
      No type 5 external LSA
      No ASBR allowed
    ОСОБЕННОСТИ работы со STUB и TOTALY STUB зонами
        Из stub area в другие зоны можно попасть по дефолтному маршруту
        В зоне должен быть хотя бы один ABR
        Каждый маршрутизатор должен быть настроен как stub
        В этих зонах не может быть ASBR
        Backbone area не может быть stub или totaly stub
    Area 3 NSSA(ничего не знает о внешней и соседней сети, но при наличии дополнительного  источника информации может передать её внутрь. Получается аналог stub, но могут быть  ASBR)
      No type 5 external LSA
      ASBR allowed
    Area 4 Totally NSSA
      No type 3 summary LSA
      No type 5 external LSA
      ASBR allowed

  Назначение зон:
    снизить нагрузку на ЦПУ маршрутизаторов за счет уменьшения кол-ва перерасчетов по алгоритму SPF
    уменьшить размер таблиц маршрутизации(за счёт суммирования маршрутов на границах зон)(можно решить с помощью агрегированных сетей)
    уменьшить кол-во пакетов обновлений сострояния канала
    безопасность

Установка соединения: [01:59]
  [link](https://github.com/dbudakov/22.route/blob/master/OSPF_process.md)

Кольца:
  При переходе из одной зоны в другую, маршрутная информация может исказиться и пакет может закольцеваться, то есть если маршрутизатору известны маршруты к одной и той же сети, но эти маршруты разных типов, то маршрутизатор выбирает наиболее
  приоритетный тип маршрута и не учитывает стоимость маршрута.
  Типы маршрутов, в порядке убывания приоритета:
  Внутренние маршруты зоны(intra-area)
  Маршруты между зонами (interarea)
  Внешние маршруты типа 1(E1)
    помимо своей метрики, добавляется метрика OSPF
  Внешние маршруты типа 2(E2)
    устанавливается только своя метрика


info:

QoS(Quality of Service)
TOS(Type of Service)
backbone(опорная сеть)- нулевая зона/спина, имеет соответственно 0'ой номер, остальные ненулевые зоны, обязаны быть подключены к нулевой зоне.
если на прямом линке настраивается отключение DR, нужно быть уверенным что там не появится ещё коммутатор

ip maddress show #  мультикаст адреса
  vtysh
    sh ip os neighbor
    sh ip ospf database
    ip ospf network # показывает 4 типа линков

+info:
флапанье линков
TCP[[№06](https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml)]
UDP[[№17](https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml)]
